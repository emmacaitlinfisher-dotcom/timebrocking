<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Weekly Time-Blocking Board (Emma + Brock)</title>

<style>
:root{
  --bg:#0b0c10;
  --text:#e9ecf1;
  --muted:#aab2c0;
  --emma:#4b8cff;
  --brock:#ff7a59;
  --shared:#7bd389;
  --radius:16px;
  --cellH:44px;
  --timeW:86px;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:radial-gradient(1200px 800px at 20% 0%,#141828 0%,var(--bg) 55%);
  color:var(--text);
}
.wrap{max-width:1280px;margin:28px auto;padding:0 16px 40px}
h1{margin:0 0 6px;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin-bottom:14px;line-height:1.35}

.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;align-items:center}
.btn{
  background:#1b2234;color:#fff;border:1px solid rgba(255,255,255,.1);
  padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700
}
select,input{
  background:#1b2234;color:#fff;border:1px solid rgba(255,255,255,.1);
  border-radius:12px;padding:10px 12px
}

.board{border:1px solid rgba(255,255,255,.1);border-radius:var(--radius);overflow:hidden}
.grid{
  display:grid;
  grid-template-columns: var(--timeW) repeat(14, 1fr); /* 7 days × 2 people */
}

.cell{
  border-right:1px solid rgba(255,255,255,.06);
  border-bottom:1px solid rgba(255,255,255,.06);
  min-height:var(--cellH);
  position:relative;
}
.header{
  background:#111622;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:13px;
}
.subheader{
  background:#0f1420;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:12px;
  color:rgba(255,255,255,.85);
}
.time{
  background:#111622;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;color:var(--muted);
}

/* IMPORTANT: allow shared blocks to visually extend into the next column */
.drop{
  padding:6px;
  overflow:visible;
}

.block{
  background:#20263a;
  border:1px solid rgba(255,255,255,.15);
  border-radius:12px;
  padding:8px 10px;
  cursor:grab;
  display:flex;
  justify-content:space-between;
  gap:8px;
  font-size:13px;
  user-select:none;
  width:100%;
  position:relative;
  z-index:2;
}
.block:active{cursor:grabbing}
.tag{width:10px;height:10px;border-radius:50%;margin-top:4px}
.x{background:none;border:none;color:#aaa;cursor:pointer;font-size:16px;line-height:1}

/* Shared blocks span both columns */
.block.shared-span{
  width: calc(200% + 1px); /* +1px to cover the column border */
  z-index: 5;
}

.legend{display:flex;gap:14px;margin-top:10px;font-size:12px;color:var(--muted);flex-wrap:wrap}
.dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}

@media print{
  body{background:#fff;color:#000}
  .controls,.sub,.legend{display:none !important}
  .board{border:1px solid #ddd}
  .cell{border-color:#e6e6e6}
  .header,.subheader,.time{background:#f6f6f6;color:#111}
  .block{border-color:#ddd;box-shadow:none}
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Weekly Time-Blocking Board</h1>
  <div class="sub">
    Two columns per day: <b>E</b> (Emma) + <b>B</b> (Brock).<br>
    <b>Shared</b> blocks automatically span both columns for that day/time.
  </div>

  <div class="controls">
    <button class="btn" id="newBlock">New Block</button>

    <label style="color:var(--muted);font-size:13px;">Owner</label>
    <select id="owner">
      <option value="emma">Emma</option>
      <option value="brock">Brock</option>
      <option value="shared">Shared</option>
    </select>

    <label style="color:var(--muted);font-size:13px;">Label</label>
    <input id="label" value="Busy">

    <button class="btn" id="printBtn">Print / Save PDF</button>
    <button class="btn" id="clearBtn">Clear</button>
  </div>

  <div class="board">
    <div class="grid" id="grid"></div>
  </div>

  <div class="legend">
    <span><span class="dot" style="background:var(--emma)"></span>Emma</span>
    <span><span class="dot" style="background:var(--brock)"></span>Brock</span>
    <span><span class="dot" style="background:var(--shared)"></span>Shared</span>
  </div>
</div>

<script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    getFirestore,
    doc,
    setDoc,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCJFg_mqOB9tmCsUiUKq8qyZM0jRtbfq5s",
    authDomain: "timebrocking.firebaseapp.com",
    projectId: "timebrocking",
    storageBucket: "timebrocking.firebasestorage.app",
    messagingSenderId: "682167129728",
    appId: "1:682167129728:web:867e9ef0492bea8df5f865"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const boardRef = doc(db, "boards", "default");

  let suppressWrite = false;

  async function saveBoard() {
    if (suppressWrite) return;

    const blocks = [];
    document.querySelectorAll(".block").forEach(b => {
      const cell = b.closest(".cell.drop");
      if (!cell) return;
      blocks.push({
        id: b.id,
        owner: b.dataset.owner,
        label: b.dataset.label,
        day: Number(cell.dataset.day),
        time: Number(cell.dataset.time),
        person: cell.dataset.person
      });
    });

    await setDoc(boardRef, { blocks }, { merge: true });
  }

  function renderBoard(blocks = []) {
    suppressWrite = true;

    document.querySelectorAll(".cell.drop").forEach(c => c.innerHTML = "");

    blocks.forEach(data => {
      const b = document.createElement("div");
      b.className = "block";
      b.draggable = true;
      b.id = data.id;
      b.dataset.owner = data.owner;
      b.dataset.label = data.label;

      b.ondragstart = e => e.dataTransfer.setData("id", b.id);

      const left = document.createElement("div");
      left.textContent = data.label;

      const right = document.createElement("button");
      right.textContent = "×";
      right.className = "x";
      right.onclick = async () => { b.remove(); await saveBoard(); };

      b.append(left, right);

      const target = document.querySelector(
        `.cell.drop[data-day="${data.day}"][data-time="${data.time}"][data-person="${data.person}"]`
      );
      if (target) target.appendChild(b);
    });

    setTimeout(() => suppressWrite = false, 50);
  }

  onSnapshot(boardRef, snap => {
    renderBoard(snap.data()?.blocks || []);
  });

  window.addEventListener("mouseup", saveBoard);
</script>
</script>
</body>
</html>
