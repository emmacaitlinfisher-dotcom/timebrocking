<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Weekly Time-Blocking Board (Emma + Brock)</title>

<style>
:root{
  --bg:#0b0c10;
  --text:#e9ecf1;
  --muted:#aab2c0;
  --emma:#4b8cff;
  --brock:#ff7a59;
  --shared:#7bd389;
  --radius:16px;
  --cellH:44px;
  --timeW:86px;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:radial-gradient(1200px 800px at 20% 0%,#141828 0%,var(--bg) 55%);
  color:var(--text);
}
.wrap{max-width:1280px;margin:28px auto;padding:0 16px 40px}
h1{margin:0 0 6px;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin-bottom:14px;line-height:1.35}

.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;align-items:center}
.btn{
  background:#1b2234;color:#fff;border:1px solid rgba(255,255,255,.1);
  padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700
}
select,input{
  background:#1b2234;color:#fff;border:1px solid rgba(255,255,255,.1);
  border-radius:12px;padding:10px 12px
}

.board{border:1px solid rgba(255,255,255,.1);border-radius:var(--radius);overflow:hidden}
.grid{
  display:grid;
  grid-template-columns: var(--timeW) repeat(14, 1fr); /* 7 days × 2 people */
}

.cell{
  border-right:1px solid rgba(255,255,255,.06);
  border-bottom:1px solid rgba(255,255,255,.06);
  min-height:var(--cellH);
  position:relative;
}
.header{
  background:#111622;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:13px;
}
.subheader{
  background:#0f1420;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:12px;
  color:rgba(255,255,255,.85);
}
.time{
  background:#111622;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;color:var(--muted);
}

/* IMPORTANT: allow shared blocks to visually extend into the next column */
.drop{
  padding:6px;
  overflow:visible;
}

.block{
  background:#20263a;
  border:1px solid rgba(255,255,255,.15);
  border-radius:12px;
  padding:8px 10px;
  cursor:grab;
  display:flex;
  justify-content:space-between;
  gap:8px;
  font-size:13px;
  user-select:none;
  width:100%;
  position:relative;
  z-index:2;
}
.block:active{cursor:grabbing}
.tag{width:10px;height:10px;border-radius:50%;margin-top:4px}
.x{background:none;border:none;color:#aaa;cursor:pointer;font-size:16px;line-height:1}

/* Shared blocks span both columns */
.block.shared-span{
  width: calc(200% + 1px); /* +1px to cover the column border */
  z-index: 5;
}

.legend{display:flex;gap:14px;margin-top:10px;font-size:12px;color:var(--muted);flex-wrap:wrap}
.dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}

@media print{
  body{background:#fff;color:#000}
  .controls,.sub,.legend{display:none !important}
  .board{border:1px solid #ddd}
  .cell{border-color:#e6e6e6}
  .header,.subheader,.time{background:#f6f6f6;color:#111}
  .block{border-color:#ddd;box-shadow:none}
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Weekly Time-Blocking Board</h1>
  <div class="sub">
    Two columns per day: <b>E</b> (Emma) + <b>B</b> (Brock).<br>
    <b>Shared</b> blocks automatically span both columns for that day/time.
  </div>

  <div class="controls">
    <button class="btn" id="newBlock">New Block</button>

    <label style="color:var(--muted);font-size:13px;">Owner</label>
    <select id="owner">
      <option value="emma">Emma</option>
      <option value="brock">Brock</option>
      <option value="shared">Shared</option>
    </select>

    <label style="color:var(--muted);font-size:13px;">Label</label>
    <input id="label" value="Busy">

    <button class="btn" id="printBtn">Print / Save PDF</button>
    <button class="btn" id="clearBtn">Clear</button>
  </div>

  <div class="board">
    <div class="grid" id="grid"></div>
  </div>

  <div class="legend">
    <span><span class="dot" style="background:var(--emma)"></span>Emma</span>
    <span><span class="dot" style="background:var(--brock)"></span>Brock</span>
    <span><span class="dot" style="background:var(--shared)"></span>Shared</span>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  const START = 6;    // 6:00
  const END = 22;     // 22:00
  const STEP = 60;    // minutes per row (set to 30 if you want half-hours)

  const grid = document.getElementById("grid");
  const ownerSel = document.getElementById("owner");
  const labelInput = document.getElementById("label");
  const newBtn = document.getElementById("newBlock");
  const printBtn = document.getElementById("printBtn");
  const clearBtn = document.getElementById("clearBtn");

  const colors = {
    emma: getComputedStyle(document.documentElement).getPropertyValue("--emma").trim(),
    brock: getComputedStyle(document.documentElement).getPropertyValue("--brock").trim(),
    shared: getComputedStyle(document.documentElement).getPropertyValue("--shared").trim()
  };

  function timeLabel(min){
    const h = Math.floor(min/60);
    const m = min % 60;
    const am = h >= 12 ? "pm" : "am";
    const hh = ((h + 11) % 12) + 1;
    return `${hh}:${String(m).padStart(2,"0")}${am}`;
  }

  function makeCell(text, cls){
    const d = document.createElement("div");
    d.className = "cell " + cls;
    if (text) d.textContent = text;
    return d;
  }

  function getCell(day, time, person){
    return document.querySelector(`.cell.drop[data-day="${day}"][data-time="${time}"][data-person="${person}"]`);
  }

  function setBlockVisualMode(block, mode){
    // mode: "single" | "shared"
    if (mode === "shared") block.classList.add("shared-span");
    else block.classList.remove("shared-span");
  }

  function placeSharedBlock(block, day, time){
    // shared blocks always anchor in Emma column and span across
    const emmaCell = getCell(day, time, "emma");
    const brockCell = getCell(day, time, "brock");
    if (!emmaCell || !brockCell) return;

    // clear both cells then place in Emma cell
    emmaCell.innerHTML = "";
    brockCell.innerHTML = "";

    setBlockVisualMode(block, "shared");
    emmaCell.appendChild(block);
  }

  function placeSingleBlock(block, targetCell){
    targetCell.innerHTML = "";
    setBlockVisualMode(block, "single");
    targetCell.appendChild(block);
  }

  function onDropInto(e, targetCell){
    e.preventDefault();
    const id = e.dataTransfer.getData("id");
    const block = document.getElementById(id);
    if (!block) return;

    const owner = block.dataset.owner;

    const day = Number(targetCell.dataset.day);
    const time = Number(targetCell.dataset.time);

    if (owner === "shared"){
      placeSharedBlock(block, day, time);
    } else {
      placeSingleBlock(block, targetCell);
    }
    save();
  }

  function buildGrid(){
    grid.innerHTML = "";

    // Row 1: Day headers (each spans 2 columns)
    grid.appendChild(makeCell("", "header"));
    DAYS.forEach(day => {
      const h = makeCell(day, "header");
      h.style.gridColumn = "span 2";
      grid.appendChild(h);
    });

    // Row 2: E / B subheaders
    grid.appendChild(makeCell("", "time"));
    for(let di=0; di<7; di++){
      grid.appendChild(makeCell("E", "subheader"));
      grid.appendChild(makeCell("B", "subheader"));
    }

    // Time rows
    for(let min = START*60; min < END*60; min += STEP){
      grid.appendChild(makeCell(timeLabel(min), "time"));

      for(let di=0; di<7; di++){
        const cE = makeCell("", "drop");
        cE.dataset.day = String(di);
        cE.dataset.time = String(min);
        cE.dataset.person = "emma";
        cE.ondragover = ev => ev.preventDefault();
        cE.ondrop = ev => onDropInto(ev, cE);
        grid.appendChild(cE);

        const cB = makeCell("", "drop");
        cB.dataset.day = String(di);
        cB.dataset.time = String(min);
        cB.dataset.person = "brock";
        cB.ondragover = ev => ev.preventDefault();
        cB.ondrop = ev => onDropInto(ev, cB);
        grid.appendChild(cB);
      }
    }
  }

  function newBlock(data){
    const owner = (data?.owner ?? ownerSel.value);
    const label = (data?.label ?? (labelInput.value || "Busy")).trim();
    const id = data?.id ?? ("b_" + Math.random().toString(36).slice(2));

    const b = document.createElement("div");
    b.className = "block";
    b.draggable = true;
    b.id = id;
    b.dataset.owner = owner;
    b.dataset.label = label;

    b.ondragstart = ev => ev.dataTransfer.setData("id", b.id);

    const left = document.createElement("div");
    left.textContent = label;

    const right = document.createElement("div");
    right.style.display = "flex";
    right.style.gap = "6px";
    right.style.alignItems = "flex-start";

    const tag = document.createElement("span");
    tag.className = "tag";
    tag.style.background = colors[owner] || colors.shared;

    const x = document.createElement("button");
    x.className = "x";
    x.type = "button";
    x.textContent = "×";
    x.title = "Delete";
    x.onclick = () => { b.remove(); save(); };

    right.append(tag, x);
    b.append(left, right);

    // If target provided, place there. For shared, we anchor to Emma automatically.
    if (data?.day != null && data?.time != null){
      const day = Number(data.day);
      const time = Number(data.time);
      if (owner === "shared"){
        placeSharedBlock(b, day, time);
      } else {
        const person = data.person || "emma";
        const target = getCell(day, time, person);
        (target || document.querySelector(`.cell.drop[data-person="emma"]`))?.appendChild(b);
      }
    } else {
      // default placement
      if (owner === "shared"){
        // put it in the first time row (Mon) spanning E+B
        placeSharedBlock(b, 0, START*60);
      } else {
        document.querySelector(`.cell.drop[data-person="emma"]`)?.appendChild(b);
      }
    }

    // ensure correct visual
    setBlockVisualMode(b, owner === "shared" ? "shared" : "single");
    return b;
  }

  // Local save/load (per device)
  const STORAGE_KEY = "weekly_timeboard_emma_brock_sharedspan_v1";

  function save(){
    const blocks = [];
    document.querySelectorAll(".block").forEach(b => {
      const parent = b.closest(".cell.drop");
      if(!parent) return;

      // For shared blocks, parent will be Emma cell (by design)
      blocks.push({
        id: b.id,
        owner: b.dataset.owner,
        label: b.dataset.label,
        day: Number(parent.dataset.day),
        time: Number(parent.dataset.time),
        person: parent.dataset.person
      });
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ blocks }));
  }

  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const state = JSON.parse(raw);
      state.blocks?.forEach(b => newBlock(b));
    }catch{}
  }

  // Wire up buttons
  newBtn.onclick = () => { newBlock(); save(); };
  printBtn.onclick = () => window.print();
  clearBtn.onclick = () => {
    if(!confirm("Clear all blocks?")) return;
    document.querySelectorAll(".block").forEach(b => b.remove());
    localStorage.removeItem(STORAGE_KEY);
  };

  // Build and load
  buildGrid();
  load();

  // Best-effort autosave when you let go of a drag or click
  window.addEventListener("mouseup", save);
});
</script>
</body>
</html>
